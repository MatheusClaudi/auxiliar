<div class="poker-planning">
    <div class="poker-container">
        <div *ngIf="(!inVotation) && currentUs != undefined && roomId != undefined " class="result-votation" >
            <app-result-chart [id]="roomId"></app-result-chart>
        </div>
        <div class="button-controller"  *ngIf="hiddenController">
            <span class="open-icon m1" (click)="showOrCloseController()"></span>
        </div>
        <div class="header">
            <app-story-description class="description" *ngIf="currentUsTemp != undefined"  [userStoryId]="currentUsTemp.id"></app-story-description>
            <app-story-description class="description" *ngIf="currentUsTemp == undefined && currentUs != undefined"  [userStoryId]="currentUs.id"></app-story-description>
        </div>
            
        <div *ngIf="sprintId != undefined">
            <app-poker [inVotation]="inVotation" [sprintId]="sprintId"></app-poker>
        </div>

        <div *ngIf="userStoryClosedToVotation.length > 0" class="painel">
            <div class="outer">
                <div class="painel-header">
                    <div class="painel-options">
                        <div class="painel-option">
                            <p>Stories completos</p>
                        </div>
                    </div>
                </div>
                <table class="table">
                  <thead>
                    <tr class="us-list-conteiner">
                      <th class="alert-box" role="alert">Nome:</th>
                      <th class="alert-box" role="alert">Pontos:</th>
                      <th class="alert-box" role="alert"></th>
                    </tr>
                  </thead>
                  <tbody *ngFor="let us of userStoryClosedToVotation; let i = index">
                    <tr>
                        <td>
                          <div class="clearfix table-row" >
                            <span>{{ us.points }}</span>
                          </div>
                        </td>
                        <td>
                          <div class="clearfix table-row" >
                            <span>{{ us.storyName }}</span>
                          </div>
                        </td>
                        <td>
                            <div class="clearfix table-row float-right icons" >
                            
                                <button class="btn-us-list" (click)="resetPointsOfUserStory(us)" ngbTooltip="Cancelar votação" placement="left">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="18px" height="18px">
                                    <path d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M0 0h24v24H0V0z" fill="none"/>
                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41
                                    1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
        
    </div>
    <div [ngStyle]="myStyles" class="controller-container">
        <div class="guideBox">
            
            <div class="guide-button">
                <span class="close-icon rotate-90" (click)="showOrCloseController()"></span>
            </div>
            
            <div class="guide-text">
                <p *ngIf="!inVotation && !currentUs">Clique em INICIAR para começar a votação</p>
                <p *ngIf="inVotation && currentUs">Em Votação</p>
                <p *ngIf="!inVotation && currentUs">Votação finalizada</p>
            </div>
        </div>

        <div class="margin-h-2 margin-v-1">
            <div *ngIf="roomId">
                <app-user-in-room-list [id]="roomId" [inVotation]="inVotation" [hasUserStory]="!!currentUs"></app-user-in-room-list>
            </div>

            <div *ngIf="!votationOpen">
             
                <div ngbDropdown class="dropdown dropdown-us d-inline-block">
                    
                    <button *ngIf="!currentUsTemp" class="btn btn-outline-primary area-limit" id="dropdownBasic1" ngbDropdownToggle>Escolha de us</button>
                    <button *ngIf="currentUsTemp" [ngbPopover]="currentUsTemp.storyName"
                    [openDelay]="300" [closeDelay]="500" triggers="mouseenter:mouseleave" class="btn btn-outline-primary area-limit" id="dropdownBasic1" ngbDropdownToggle>{{currentUsTemp.storyName}}</button>
                    
                    <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                        <button *ngFor="let us of userStoryOpenToVotation" [ngbPopover]="us.storyName" class="area-limit"
                        [openDelay]="300" [closeDelay]="500" triggers="mouseenter:mouseleave" (click)="changeUserStory(us)" ngbDropdownItem>{{us.storyName}}</button>
                    </div>
                </div>
               
                <button class="circular-button blue font-b large-b" (click)="changeUSInVotation()" [disabled]="!currentUsTemp">INICIAR</button>
            </div>

            <div *ngIf="votationOpen">
                
                <div class="votationopen-buttons">
                    <button  class="circular-button gray font-b tiny-b" *ngIf="inVotation" (click)="cleanVotes()">Limpar votos</button>
                    <button  class="circular-button blue font-b tiny-b" *ngIf="inVotation" (click)="stopVotation()">Encerrar votação</button>    
                </div>
                
                <div class="votationclosed-buttons">
                    <div *ngIf="!inVotation">
                        <div class="votationend-form">
                            <div ngbDropdown class="dropdown dropdown-points d-inline-block">

                                <button *ngIf="!pointsForUs" class="btn btn-outline-primary input-1" id="dropdownBasic1" ngbDropdownToggle>Pontuar</button>
                                <button *ngIf="pointsForUs" class="btn btn-outline-primary  input-1" id="dropdownBasic1" ngbDropdownToggle>{{pointsForUs}}</button>
                                
                                <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                                    <button *ngFor="let vote of listOfConfirmedVotes" (click)="changePoints(vote)" ngbDropdownItem>{{vote}}</button>
                                </div>
                            </div>            
                            <button class="form-button circular-button blue font-b tiny-b" (click)="endCurrentVotation()" [disabled]="!pointsForUs">Pontuar US</button>
                        </div>
                    </div>

                    <button  class="circular-button gray font-b large-b" *ngIf="!inVotation" (click)="restartVotation()">Reiniciar votação </button>
                </div>
                
            </div>
        </div>

        <div class="margin-h">
            <app-share-room *ngIf="roomId != undefined" [id]="roomId"></app-share-room>
        </div>
    </div>
</div>